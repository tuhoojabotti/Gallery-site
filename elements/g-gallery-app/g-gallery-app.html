<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<script src="../../bower_components/page/page.js"></script>
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation-runner-behavior.html">

<dom-module id="g-gallery-app">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <g-picture-store pictures="{{pictures}}"></g-picture-store>

    <g-thumbnail-view id="grid" selected-picture="{{selectedPicture}}" pictures="{{pictures}}"></g-thumbnail-view>
    <g-picture-view id="overlay" selected-picture="{{selectedPicture}}" pictures="{{pictures}}"></g-picture-view>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'g-gallery-app',

      ready: function () {
        var app = this;

        page.base('/Gallery-site');

        page('/', function () {
          app.selectedPicture = undefined;
        });

        page('/view/:id', function (data) {
          app.selectedPicture = parseInt(data.params.id, 10);
        });

        // add #! before urls
        page({
          hashbang: true
        });

        // Configure animations:
        this.$.grid.getAnimationConfig('exit')[0].toPage = this.$.overlay;
        this.$.grid.getAnimationConfig('exit')[1].toPage = this.$.overlay;
        this.$.overlay.getAnimationConfig('entry')[0].fromPage = this.$.grid;
        this.$.overlay.getAnimationConfig('entry')[1].fromPage = this.$.grid;
      },

      listeners: {
        'neon-animation-finish': '_onNeonAnimationFinish'
      },

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        selectedPicture: {
          type: Number,
          observer: '_selectedPictureChanged'
        },

        animationConfig: {
          value: function () {
            return {
              showPictureOverlay: [
                { animatable: this.$.grid,    type: 'exit' },
                { animatable: this.$.overlay, type: 'entry' }
              ],
              hidePictureOverlayWithHero: [
                { animatable: this.$.grid,    type: 'entry' },
                { animatable: this.$.overlay, type: 'exit' }
              ],
              hidePictureOverlaySimple: [
                { animatable: this.$.overlay, type: 'exitSimple' }
              ]
            };
          }
        }
      },

      _selectedPictureChanged: function (index) {
        var hasHero = !!this.$.grid.sharedElements.hero;

        if (index !== undefined) {
          this.$.overlay.style.display = 'block';
          if (hasHero) {
            this.playAnimation('showPictureOverlay');
          } else {
            this.$.overlay.pictureHeight = '';
          }
        } else {
          if (hasHero) {
            this.playAnimation('hidePictureOverlayWithHero');
          } else {
            this.playAnimation('hidePictureOverlaySimple');
          }
        }
      },

      _onNeonAnimationFinish: function() {
        if (this.selectedPicture === undefined) {
          this.$.overlay.pictureHeight = 150;
          this.$.overlay.style.display = 'none';
        } else {
          this.$.overlay.pictureHeight = '';
        }
      }

    });
  })();
  </script>
</dom-module>
